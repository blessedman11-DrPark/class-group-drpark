<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>박헌규 교수님 과목 조편성 프로그램</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="classgrouping.css">
</head>
<body>
    <div class="container">
        <!-- 헤더: 제목 + 로그인 버튼 -->
        <div class="header">
            <h1>박헌규 교수님 과목 조편성 프로그램</h1>
            <div class="header-login">
                <button class="admin-btn primary" id="adminLoginBtn" onclick="showLoginModal()">
                    교수님 로그인
                </button>
                <button class="admin-btn" id="adminLogoutBtn" style="display: none; background: #3498db;" onclick="goHome()">
                    홈페이지
                </button>
                <button class="admin-btn" style="background: #9b59b6; color: white; margin-top: 5px;" onclick="showRulesModal()">
                    조편성 원칙
                </button>
            </div>
        </div>

        <!-- 과목 버튼 -->
        <div class="subject-buttons" id="subjectButtons">
            <!-- 동적으로 생성됨 -->
        </div>

        <!-- 관리자 패널 (로그인 후 표시) -->
        <div class="admin-panel" id="adminPanel" style="display: none;">
            <h3>관리자 패널</h3>

            <div class="admin-controls">
                <label>조당 인원수:</label>
                <input type="number" id="groupSize" min="2" max="10" value="4" style="width: 80px;" onchange="saveGroupSize()">
                <button class="admin-btn success" onclick="assignGroups()">조편성 실행</button>
                <button class="admin-btn danger" onclick="resetGroups()">조편성 초기화</button>
            </div>

            <div class="student-list-editor">
                <h4>학생 명단 편집 <span id="currentSubjectName" style="color: #667eea;">(과목을 선택하세요)</span></h4>
                <textarea id="studentListText" placeholder="예: 홍길동, 백두산, 금강산"></textarea>
                <p class="editor-hint">* 학생 이름을 콤마(,)로 구분하여 (" "도 가능) 입력 후 저장 버튼을 클릭하세요.</p>
                <button class="admin-btn primary" onclick="saveStudentList()" style="margin-top: 10px;">학생 명단 저장</button>
            </div>

            <div class="subject-edit-area">
                <div class="subject-edit-header">
                    <h4>과목명 수정</h4>
                    <button class="admin-btn primary" onclick="saveSubjectNames()">과목명 저장</button>
                </div>
                <div id="subjectEditList">
                    <!-- 동적으로 생성됨 -->
                </div>
            </div>

            <div class="subject-edit-area">
                <div class="subject-edit-header">
                    <h4>과목별 암호 설정</h4>
                    <button class="admin-btn primary" onclick="saveSubjectPasswords()">암호 저장</button>
                </div>
                <div id="subjectPasswordList">
                    <!-- 동적으로 생성됨 -->
                </div>
            </div>

            <div class="subject-edit-area">
                <div class="subject-edit-header" style="flex-wrap: wrap; gap: 10px;">
                    <h4>교수님 암호 수정</h4>
                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                        <input type="password" id="adminPw1" class="admin-pw-input" placeholder="암호 1">
                        <input type="password" id="adminPw2" class="admin-pw-input" placeholder="암호 2">
                        <button class="admin-btn primary" onclick="saveAdminPasswords()">암호 저장</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 과목 정보 -->
        <div class="subject-info" id="subjectInfo" style="display: none;">
            <div class="info-title" id="infoTitle"></div>
            <div class="info-detail" id="infoDetail"></div>
        </div>

        <!-- 카드 영역 -->
        <div class="cards-container" id="cardsContainer">
            <p class="guide-message">과목을 선택하고 암호를 입력하세요</p>
        </div>

        <!-- 전체보기 버튼 -->
        <button class="view-all-btn" id="viewAllBtn" style="display: none;" onclick="showAllGroups()">
            전체 보기
        </button>
    </div>

    <!-- 로그인 모달 -->
    <div class="login-modal" id="loginModal">
        <div class="login-box">
            <h3>교수님 인증</h3>
            <input type="password" id="passwordInput" placeholder="암호를 입력하세요" onkeypress="if(event.key==='Enter') login()">
            <br>
            <button onclick="login()">확인</button>
            <button id="loginCancelBtn" onclick="hideLoginModal()" style="background: #95a5a6; margin-left: 10px;">취소</button>
            <button id="loginRetryBtn" onclick="retryLogin()" style="background: #3498db; margin-left: 10px; display: none;">재시도</button>
            <p class="login-error" id="loginError"></p>
        </div>
    </div>

    <!-- 과목 암호 확인 모달 -->
    <div class="login-modal" id="subjectPasswordModal">
        <div class="login-box">
            <h3 id="subjectPasswordTitle">과목 암호 입력</h3>
            <input type="password" id="subjectPasswordInput" placeholder="암호를 입력하세요" onkeypress="if(event.key==='Enter') verifySubjectPassword()">
            <br>
            <button onclick="verifySubjectPassword()">확인</button>
            <button id="subjectPasswordCancelBtn" onclick="hideSubjectPasswordModal()" style="background: #95a5a6; margin-left: 10px;">취소</button>
            <button id="subjectPasswordRetryBtn" onclick="retrySubjectPassword()" style="background: #3498db; margin-left: 10px; display: none;">재시도</button>
            <p class="login-error" id="subjectPasswordError"></p>
        </div>
    </div>

    <!-- 전체보기 모달 -->
    <div class="modal" id="groupModal">
        <div class="modal-content">
            <span class="modal-close" onclick="hideGroupModal()">&times;</span>
            <h2 id="groupModalTitle">조별 명단</h2>
            <div class="group-list" id="groupList">
                <!-- 동적으로 생성됨 -->
            </div>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button class="show-all-groups-btn" style="margin: 0;" onclick="showAllGroupsAtOnce()">조 전체보기</button>
                <button class="show-all-groups-btn" style="margin: 0; background: #95a5a6;" onclick="hideGroupModal()">닫기</button>
            </div>
        </div>
    </div>

    <!-- 조편성 원칙 모달 -->
    <div class="modal" id="rulesModal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="modal-close" onclick="hideRulesModal()">&times;</span>
            <h2 style="color: #667eea; margin-bottom: 20px;">조편성 원칙</h2>
            <div class="rules-content">
                <h3>1. 기본 원칙</h3>
                <ul>
                    <li>학생들은 <strong>무작위로 섞인 상태로</strong> 각 조에 배정됩니다.</li>
                    <li>조당 인원수는 <strong>2명~10명</strong> 사이에서 설정됩니다.</li>
                </ul>

                <h3>2. 남은 인원 처리 기준</h3>
                <p>조당 기준 인원수로 편성하고 남은 학생은 그 수에 따라 다르게 처리됩니다:</p>
                <table class="rules-table">
                    <thead>
                        <tr>
                            <th>조당 인원</th>
                            <th>새 조 생성 기준</th>
                            <th>기존 조 분배 기준</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>3명</td><td>2명 이상 남았을 때</td><td>잔여 1명</td></tr>
                        <tr><td>4명</td><td>3명 이상 남았을 때</td><td>잔여 2명 이하</td></tr>
                        <tr><td>5명</td><td>3명 이상 남았을 때</td><td>잔여 2명 이하</td></tr>
                        <tr><td>6명</td><td>4명 이상 남았을 때</td><td>잔여 3명 이하</td></tr>
                    </tbody>
                </table>

                <h3>3. 분배 방식</h3>
                <ul>
                    <li><strong>새 조 생성:</strong> 남은 인원이 기준 이상이면 별도의 조로 편성</li>
                    <li><strong>기존 조 분배:</strong> 남은 인원이 기준 미만이면 기존 조들에 고르게 분배</li>
                </ul>

                <h3>4. 예시</h3>
                <div class="rules-example">
                    <p><strong>예시 1:</strong> 23명, 3명씩 편성</p>
                    <p>→ 7개조 편성 후 2명 남음 → 2명은 새로운 조로 편성 → <strong>8개 조</strong> (7개조는 3명, 1개조는 2명)</p>
                </div>
                <div class="rules-example">
                    <p><strong>예시 2:</strong> 9명, 4명씩 편성</p>
                    <p>→ 2개조 편성 후 1명 남음 → 1명은 기존의 조에 편성 → <strong>2개 조</strong> (1개조는 4명, 1개조는 5명)</p>
                </div>
            </div>
            <button class="show-all-groups-btn" onclick="hideRulesModal()" style="margin-top: 20px;">닫기</button>
        </div>
    </div>

    <!-- 푸터 -->
    <div class="footer">
        <p>Made by Prof. Park with AI tools | Powered by <a href="https://www.anthropic.com/claude-code" target="_blank">Claude Code</a>, <a href="https://github.com" target="_blank">GitHub</a>, <a href="https://supabase.com" target="_blank">Supabase</a>, <a href="https://vercel.com" target="_blank">Vercel</a> (v2.06)</p>
    </div>

    <script src="classgrouping.js"></script>
</body>
</html>
